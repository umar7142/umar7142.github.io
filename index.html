<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RailTrack | Umer Asif OSINT</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        /* üé® THEME & ANIMATIONS */
        :root {
            --bg-body: #0f172a; --bg-panel: #1e293b; --text-main: #f8fafc; --text-muted: #94a3b8;
            --accent-blue: #3b82f6; --accent-gold: #f59e0b; --accent-green: #10b981; --accent-red: #ef4444; --border-color: #334155;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); } 70% { transform: scale(1.1); box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); } 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); } }

        body { margin: 0; padding: 0; background-color: var(--bg-body); color: var(--text-main); font-family: 'Inter', sans-serif; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }

        /* üîù TOP NAVIGATION */
        header { display: flex; align-items: center; justify-content: space-between; padding: 12px 30px; background: rgba(30, 41, 59, 0.95); backdrop-filter: blur(10px); border-bottom: 1px solid var(--border-color); box-shadow: 0 4px 15px rgba(0,0,0,0.2); z-index: 1000; }
        
        .brand-container { display: flex; align-items: center; gap: 12px; }
        .custom-logo { width: 36px; height: 36px; position: relative; display: flex; align-items: center; justify-content: center; background: rgba(59,130,246,0.1); border-radius: 8px; border: 1px solid var(--accent-blue); }
        .custom-logo i { font-size: 20px; color: var(--accent-blue); }
        
        header h1 { margin: 0; font-size: 22px; font-weight: 700; letter-spacing: -0.5px; display: flex; align-items: center;}
        
        .nav-tabs { display: flex; gap: 20px; }
        .nav-tab { background: transparent; border: none; color: var(--text-muted); font-size: 14px; font-weight: 600; cursor: pointer; transition: 0.3s; padding: 8px 15px; border-radius: 8px; font-family: 'Inter', sans-serif; }
        .nav-tab:hover { color: var(--text-main); background: rgba(255,255,255,0.05); }
        .nav-tab.active { color: var(--accent-blue); background: rgba(59, 130, 246, 0.1); }

        .system-status { display: flex; gap: 15px; font-size: 13px; font-weight: 600; color: var(--text-muted); align-items: center; }
        .live-dot { border-radius: 50%; width: 10px; height: 10px; display: inline-block; background: var(--accent-green); animation: pulse 2s infinite; }

        /* üóÇÔ∏è VIEWS CONTROLLER */
        .view-section { display: none; flex: 1; overflow: hidden; animation: fadeIn 0.4s ease-out forwards; }
        .view-section.active { display: flex; }

        /* --- üåç RADAR VIEW --- */
        #radar-view { padding: 20px; gap: 20px; }
        .sidebar { width: 340px; background-color: var(--bg-panel); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; display: flex; flex-direction: column; gap: 15px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); overflow: hidden; flex-shrink: 0; }
        .sidebar-title { margin: 0; font-size: 13px; text-transform: uppercase; color: var(--text-muted); font-weight: 700; letter-spacing: 1px; border-bottom: 1px solid var(--border-color); padding-bottom: 8px; display: flex; justify-content: space-between; align-items: center;}
        
        .stat-grid { display: grid; grid-template-columns: 1fr; gap: 10px; }
        .stat-card { background-color: rgba(59, 130, 246, 0.05); border-left: 3px solid var(--accent-blue); padding: 12px; border-radius: 8px; transition: 0.3s; }
        .stat-card h3 { margin: 0; font-size: 11px; color: var(--text-muted); font-weight: 600; text-transform: uppercase; }
        .stat-card p { margin: 5px 0 0 0; font-size: 20px; font-weight: 700; color: var(--text-main); }

        .search-box { display: flex; align-items: center; background: var(--bg-body); border: 1px solid var(--border-color); border-radius: 8px; padding: 10px 15px; }
        .search-box input { background: transparent; border: none; color: var(--text-main); font-size: 13px; width: 100%; outline: none; margin-left: 10px; }

        .live-list { list-style: none; padding: 0; margin: 0; overflow-y: auto; flex: 1; padding-right: 5px; }
        .live-list::-webkit-scrollbar { width: 5px; }
        .live-list::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 4px; }
        .live-list li { padding: 12px; background-color: var(--bg-body); border: 1px solid var(--border-color); border-radius: 8px; margin-bottom: 10px; font-size: 13px; cursor: pointer; border-left: 3px solid transparent; transition: 0.2s; }
        .live-list li:hover { border-color: var(--accent-blue); background: rgba(59, 130, 246, 0.05); }
        .live-list li .train-id { color: var(--accent-blue); font-weight: 700; font-size: 14px;}

        #map { flex: 1; border: 1px solid var(--border-color); border-radius: 12px; z-index: 1; background: #0b1120; }
        .leaflet-marker-icon { outline: none !important; border: none !important; background: transparent !important; }
        
        /* THE TRAIN ICON */
        .real-train-icon { display: flex; align-items: center; justify-content: center; background: var(--accent-blue); border: 2px solid #fff; border-radius: 50%; color: #fff; width: 24px; height: 24px; font-size: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.5); transition: 0.3s; }

        /* POPUP & TAGS */
        .leaflet-popup-content-wrapper { background-color: #ffffff; color: #1e293b; border-radius: 8px; font-family: 'Inter', sans-serif; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
        .leaflet-popup-tip { background-color: #ffffff; }
        .popup-header { display: flex; align-items: center; gap: 8px; border-bottom: 1px solid #e2e8f0; padding-bottom: 8px; margin-bottom: 8px; }
        .popup-header i { color: #3b82f6; font-size: 18px; }
        .tag { background: #e2e8f0; padding: 2px 6px; border-radius: 4px; font-size: 11px; font-weight: bold; color: #0f172a; }

        /* --- üë§ ABOUT & CONTACT VIEWS --- */
        .content-box { background: var(--bg-panel); border: 1px solid var(--border-color); border-radius: 12px; padding: 40px; max-width: 600px; width: 100%; margin: 40px auto; text-align: center; }
        .content-box img { width: 100px; height: 100px; border-radius: 50%; border: 3px solid var(--accent-blue); margin-bottom: 20px; }
        .content-box h2 { margin: 0 0 10px 0; font-size: 24px; color: #fff; text-transform: uppercase; letter-spacing: 1px;}
        .content-box p { color: var(--text-muted); font-size: 15px; line-height: 1.6; }
        
        .form-group { margin-bottom: 15px; text-align: left; }
        .form-group label { display: block; margin-bottom: 5px; font-size: 13px; color: var(--text-muted); }
        .form-group input, .form-group textarea { width: 100%; padding: 12px; background: var(--bg-body); border: 1px solid var(--border-color); border-radius: 8px; color: #fff; font-family: 'Inter'; outline: none; box-sizing: border-box; }
        .form-group input:focus, .form-group textarea:focus { border-color: var(--accent-blue); }
        .submit-btn { background: var(--accent-blue); color: #fff; border: none; padding: 12px 30px; border-radius: 8px; font-weight: 700; cursor: pointer; transition: 0.3s; width: 100%; margin-top: 10px; }
        .submit-btn:hover { background: #2563eb; transform: translateY(-2px); }

        /* üì± MOBILE RESPONSIVE */
        @media (max-width: 768px) {
            header { flex-direction: column; padding: 15px; gap: 15px; }
            .nav-tabs { width: 100%; justify-content: center; flex-wrap: wrap; gap: 5px; }
            .nav-tab { flex: 1; text-align: center; font-size: 12px; padding: 10px 5px; }
            .system-status { display: none; } 
            #radar-view { flex-direction: column; padding: 10px; overflow-y: auto; }
            #map { height: 50vh; width: 100%; flex: none; border-radius: 8px; }
            .sidebar { width: 100%; flex: none; height: auto; padding: 15px; box-sizing: border-box; }
            .live-list { height: 350px; }
        }
    </style>
</head>
<body>

    <header>
        <div class="brand-container">
            <div class="custom-logo">
                <i class="fa-solid fa-train"></i>
            </div>
            <h1>RAILTRACK <span style="font-weight: 400; color: var(--text-muted); font-size: 16px; margin-left: 8px;">| GROUND OSINT</span></h1>
        </div>
        
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('radar')"><i class="fa-solid fa-satellite-dish"></i> Live Trains</button>
            <button class="nav-tab" onclick="switchTab('about')"><i class="fa-solid fa-user-astronaut"></i> About</button>
            <button class="nav-tab" onclick="switchTab('contact')"><i class="fa-solid fa-envelope"></i> Contact</button>
        </div>

        <div class="system-status">
            <div class="live-dot" id="dot-anim"></div>
            <span id="api-text">Initializing Ground Radar...</span>
            <span id="db-status" style="margin-left: 15px; color: #ef4444;"><i class="fa-solid fa-database"></i> DB Offline</span>
        </div>
    </header>

    <div id="radar-view" class="view-section active">
        <div class="sidebar">
            <h2 class="sidebar-title"><i class="fa-solid fa-chart-pie"></i> US Rail Analytics</h2>
            <div class="stat-grid">
                <div class="stat-card"><h3>Active Trains (Amtrak)</h3><p id="train-count">0</p></div>
            </div>
            
            <div class="search-box" style="margin-top: 10px;">
                <i class="fa-solid fa-magnifying-glass"></i>
                <input type="text" id="train-search" placeholder="Search Train Name or Route...">
            </div>

            <ul class="live-list" id="train-feed"></ul>
        </div>
        <div id="map"></div>
    </div>

    <div id="about-view" class="view-section" style="display: none;">
        <div class="content-box">
            <img src="https://ui-avatars.com/api/?name=Umer+Asif&background=3b82f6&color=fff&size=128" alt="CEO Umer Asif">
            <h2>UMER ASIF</h2>
            <p style="color: var(--accent-blue); font-weight: 600; margin-top: -5px;">Tech CEO & Full-Stack Developer</p>
            <p>Welcome to RailTrack OSINT. When the skies closed, we took over the ground. This platform tracks live US Railway systems (Amtrak) in real-time, completely bypassing traditional API restrictions. Welcome to the future of Ground Tracking.</p>
        </div>
    </div>

    <div id="contact-view" class="view-section" style="display: none;">
        <div class="content-box">
            <h2>Get in Touch</h2>
            <p>Interested in purchasing this Ground Engine or hiring me? Send a transmission below.</p>
            <form id="contact-form" onsubmit="window.submitContactForm(event)">
                <div class="form-group"><label>Your Identity</label><input type="text" id="contact-name" placeholder="John Doe" required></div>
                <div class="form-group"><label>Email Frequency</label><input type="email" id="contact-email" placeholder="john@company.com" required></div>
                <div class="form-group"><label>Transmission Message</label><textarea id="contact-msg" rows="4" placeholder="Let's build something..." required></textarea></div>
                <button type="submit" class="submit-btn" id="submit-btn"><i class="fa-solid fa-paper-plane" style="margin-right: 8px;"></i> <span id="submit-text">Send Message</span></button>
            </form>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
        import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDy07Y1jTioK57WQnULCfB1cZvlR_P3j8A",
            authDomain: "hacking-solutions.firebaseapp.com",
            databaseURL: "https://hacking-solutions-default-rtdb.firebaseio.com",
            projectId: "hacking-solutions",
            storageBucket: "hacking-solutions.firebasestorage.app",
            messagingSenderId: "1074731011147",
            appId: "1:1074731011147:web:c27d725780fc9e0848d1ce"
        };

        try {
            const app = initializeApp(firebaseConfig);
            const db = getDatabase(app);
            document.getElementById("db-status").style.color = "#10b981";
            document.getElementById("db-status").innerHTML = `<i class="fa-solid fa-database"></i> DB Connected`;
            
            window.saveStatsToDatabase = function(trains) {
                if (trains > 0) { push(ref(db, 'RailTrack_Analytics'), { timestamp: new Date().toISOString(), active_trains: trains }); }
            };

            window.submitContactForm = async function(event) {
                event.preventDefault();
                const btnText = document.getElementById('submit-text');
                btnText.innerText = "Transmitting...";
                const name = document.getElementById('contact-name').value;
                const email = document.getElementById('contact-email').value;
                const msg = document.getElementById('contact-msg').value;

                try {
                    await push(ref(db, 'Client_Messages'), { name: name, email: email, message: msg, timestamp: new Date().toISOString() });
                    alert("Message successfully sent to Umer Asif's Database!");
                    document.getElementById('contact-form').reset();
                } catch(error) { alert("Error: " + error.message); }
                btnText.innerText = "Send Message";
            };

        } catch (error) { 
            console.error("Firebase Error:", error);
            window.saveStatsToDatabase = function() {}; 
        }
    </script>
    
    <script>
        function switchTab(tabId) {
            document.querySelectorAll('.view-section').forEach(view => view.style.display = 'none');
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(`${tabId}-view`).style.display = 'flex';
            event.currentTarget.classList.add('active');
            if(tabId === 'radar') { setTimeout(() => { map.invalidateSize(); }, 100); }
        }

        // USA MAP CENTER 
        var map = L.map('map').setView([39.8283, -98.5795], 4); 
        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', { maxZoom: 19 }).addTo(map);
        
        // Layers for better management
        var trainLayer = L.layerGroup().addTo(map);
        var trackLayer = L.layerGroup().addTo(map);

        function getTrainIcon() {
            return L.divIcon({ 
                html: `<div class="real-train-icon"><i class="fa-solid fa-train-subway"></i></div>`, 
                className: '', 
                iconSize: [24, 24], 
                iconAnchor: [12, 12], 
                popupAnchor: [0, -12] 
            });
        }

        let activeMarkers = {};

        document.getElementById('train-search').addEventListener('input', function(e) {
            let searchTerm = e.target.value.toLowerCase();
            document.querySelectorAll('#train-feed li').forEach(li => {
                li.style.display = li.innerText.toLowerCase().includes(searchTerm) ? 'block' : 'none';
            });
        });

        // üö® LIVE US TRAIN API WITH RED PATH TRACKING üö®
        async function fetchLiveTrains() {
            try {
                document.getElementById("api-text").innerText = "Syncing with Railways...";
                document.getElementById("dot-anim").style.background = "#f59e0b";

                let response = await fetch('https://api-v3.amtraker.com/v3/trains');
                if(!response.ok) throw new Error("API Down");
                
                let rawData = await response.json();
                
                const feedContainer = document.getElementById('train-feed');
                feedContainer.innerHTML = ''; 
                let trainCount = 0;
                let currentTrainIDs = new Set(); 

                for (let key in rawData) {
                    let trainInstances = rawData[key];
                    if(trainInstances && trainInstances.length > 0) {
                        let train = trainInstances[0]; 
                        
                        if(!train.lat || !train.lon || train.lat === 0) continue;

                        let trainId = `Train-${train.trainNum}`;
                        currentTrainIDs.add(trainId);
                        trainCount++;

                        let trainName = train.routeName || "Amtrak Service";
                        let speed = train.velocity ? Math.round(train.velocity * 1.609) : 0; 
                        let status = train.trainState || "En Route";

                        let popupHTML = `
                            <div class="popup-header"><i class="fa-solid fa-train"></i><div class="popup-title">${trainName}</div></div>
                            <div style="margin-bottom: 10px;"><span class="tag">US RAILWAYS</span></div>
                            <div class="popup-info"><b>Train ID:</b> #${train.trainNum}</div>
                            <div class="popup-info"><b>Status:</b> ${status}</div>
                            <div class="popup-info"><b>Speed:</b> ${speed} km/h</div>
                            <div class="popup-info"><b>Destination:</b> ${train.destName}</div>
                        `;

                        // üî¥ MAP DRAWING LOGIC (The Red Line Tracking) üî¥
                        if(activeMarkers[trainId]) {
                            // Agar train pehle se map par hai, toh uski location update karo
                            activeMarkers[trainId].marker.setLatLng([train.lat, train.lon]);
                            activeMarkers[trainId].marker.setPopupContent(popupHTML);
                            
                            // History mein naya point add karo
                            activeMarkers[trainId].trailHistory.push([train.lat, train.lon]);
                            
                            // Pichle 50 points save rakho taake line boht lambi na ho jaye
                            if(activeMarkers[trainId].trailHistory.length > 50) {
                                activeMarkers[trainId].trailHistory.shift();
                            }
                            
                            // Map par Red Line draw karo
                            activeMarkers[trainId].trailLine.setLatLngs(activeMarkers[trainId].trailHistory);

                        } else {
                            // Agar naye train hai, toh pehli dafa map par dalo
                            let marker = L.marker([train.lat, train.lon], { icon: getTrainIcon() }).bindPopup(popupHTML);
                            trainLayer.addLayer(marker);
                            
                            // Red Track banayo (Line)
                            let trailLine = L.polyline([[train.lat, train.lon]], { 
                                color: '#ef4444', 
                                weight: 4, 
                                opacity: 0.8, 
                                dashArray: '5, 5' 
                            }).addTo(trackLayer);
                            
                            activeMarkers[trainId] = {
                                marker: marker,
                                trailHistory: [[train.lat, train.lon]],
                                trailLine: trailLine
                            };
                        }

                        // Add to Sidebar
                        let listItem = document.createElement('li');
                        let listText = `${trainName} ${train.destName}`.toLowerCase();
                        if(document.getElementById('train-search').value !== "" && !listText.includes(document.getElementById('train-search').value.toLowerCase())) { listItem.style.display = 'none'; }

                        listItem.innerHTML = `
                            <div class="train-id"><i class="fa-solid fa-train-subway" style="font-size:12px; margin-right:5px;"></i> ${trainName}</div>
                            <div class="airline-name">To: ${train.destName}</div>
                            <div class="flight-route">Status: ${status} | ${speed} km/h</div>
                        `;
                        listItem.onclick = () => { map.flyTo([train.lat, train.lon], 10); activeMarkers[trainId].marker.openPopup(); };
                        feedContainer.appendChild(listItem);
                    }
                }

                // Cleanup old trains that disappeared from API
                for (let tid in activeMarkers) {
                    if (!currentTrainIDs.has(tid)) {
                        trainLayer.removeLayer(activeMarkers[tid].marker);
                        trackLayer.removeLayer(activeMarkers[tid].trailLine);
                        delete activeMarkers[tid];
                    }
                }

                document.getElementById('train-count').innerText = trainCount;
                
                document.getElementById("api-text").innerText = `Live: US Ground Network`;
                document.getElementById("dot-anim").style.background = "#10b981"; 

                if(window.saveStatsToDatabase) { window.saveStatsToDatabase(trainCount); }

            } catch (error) {
                console.error(error);
                document.getElementById("api-text").innerText = "Signals Lost... Retrying.";
                document.getElementById("dot-anim").style.background = "#ef4444"; 
            }
        }

        map.on('moveend', fetchLiveTrains);
        fetchLiveTrains();
        
        // Refresh every 30 seconds
        setInterval(fetchLiveTrains, 30000); 

    </script>
</body>
</html>
