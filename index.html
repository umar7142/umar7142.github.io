<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TremorTrack | Global OSINT by Umer Asif</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        /* üåã PREMIUM GLASSMORPHISM THEME */
        :root {
            --bg-dark: #050505; --text-main: #f8fafc; --text-muted: #94a3b8;
            --accent-red: #ef4444; --accent-orange: #f97316; --accent-yellow: #eab308; --accent-blue: #0ea5e9;
            --glass-bg: rgba(15, 23, 42, 0.7); --glass-border: rgba(255, 255, 255, 0.08);
        }

        @keyframes pulseAlert { 0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(239, 68, 68, 0); } 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); } }
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; visibility: hidden; } }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        body { margin: 0; padding: 0; background-color: var(--bg-dark); color: var(--text-main); font-family: 'Inter', sans-serif; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }

        /* üîÑ LOADING SCREEN */
        #loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #050505; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 0.5s ease; }
        .spinner { width: 50px; height: 50px; border: 3px solid rgba(239, 68, 68, 0.2); border-top-color: var(--accent-red); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px; }
        #loader h2 { color: var(--accent-red); font-weight: 600; letter-spacing: 2px; text-transform: uppercase; font-size: 14px;}

        /* üîù TOP NAVIGATION (GLASS) */
        header { display: flex; align-items: center; justify-content: space-between; padding: 12px 30px; background: var(--glass-bg); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); border-bottom: 1px solid var(--glass-border); z-index: 1000; position: relative; }
        
        .brand-container { display: flex; align-items: center; gap: 15px; }
        .custom-logo { width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; background: rgba(239, 68, 68, 0.15); border-radius: 10px; border: 1px solid rgba(239, 68, 68, 0.5); animation: pulseAlert 2s infinite;}
        .custom-logo i { font-size: 20px; color: var(--accent-red); }
        header h1 { margin: 0; font-size: 22px; font-weight: 800; letter-spacing: -0.5px; }
        
        /* üóÇÔ∏è NAV TABS */
        .nav-tabs { display: flex; gap: 15px; }
        .nav-tab { background: transparent; border: 1px solid transparent; color: var(--text-muted); font-size: 14px; font-weight: 600; cursor: pointer; transition: 0.3s; padding: 8px 18px; border-radius: 8px; font-family: 'Inter', sans-serif; display: flex; align-items: center; gap: 8px;}
        .nav-tab:hover { color: var(--text-main); background: rgba(255,255,255,0.05); }
        .nav-tab.active { color: var(--accent-red); background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); }

        .system-status { display: flex; gap: 12px; font-size: 13px; font-weight: 600; color: #10b981; align-items: center; background: rgba(16, 185, 129, 0.1); padding: 8px 16px; border-radius: 20px; border: 1px solid rgba(16, 185, 129, 0.3);}
        .live-dot { border-radius: 50%; width: 8px; height: 8px; background: #10b981; box-shadow: 0 0 8px #10b981;}

        /* üóÇÔ∏è VIEWS CONTROLLER */
        .view-section { display: none; flex: 1; overflow: hidden; animation: fadeIn 0.4s ease-out forwards; position: relative; }
        .view-section.active { display: flex; }

        /* üåç MAP AREA */
        #map { flex: 1; background: #050505; z-index: 1; }

        /* üì± FLOATING SIDEBAR */
        .sidebar { position: absolute; top: 20px; left: 20px; width: 360px; height: calc(100vh - 120px); background: var(--glass-bg); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid var(--glass-border); border-radius: 16px; display: flex; flex-direction: column; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5); z-index: 10; overflow: hidden; }
        
        .sidebar-content { padding: 20px 25px; flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 15px;}
        .sidebar-content::-webkit-scrollbar { width: 4px; }
        .sidebar-content::-webkit-scrollbar-thumb { background: var(--glass-border); border-radius: 4px; }

        .section-title { margin: 0; font-size: 12px; text-transform: uppercase; color: var(--text-muted); font-weight: 700; letter-spacing: 1.5px; display: flex; align-items: center; gap: 8px;}
        
        /* üîç SEARCH BOX */
        .search-box { display: flex; align-items: center; background: rgba(0,0,0,0.4); border: 1px solid var(--glass-border); border-radius: 10px; padding: 12px 15px; transition: 0.3s;}
        .search-box:focus-within { border-color: var(--accent-red); box-shadow: 0 0 10px rgba(239, 68, 68, 0.2); }
        .search-box i { color: var(--text-muted); font-size: 14px; }
        .search-box input { background: transparent; border: none; color: var(--text-main); font-size: 13px; width: 100%; outline: none; margin-left: 10px; font-family: 'Inter'; }

        /* üìä STAT CARDS */
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .stat-card { background: rgba(255, 255, 255, 0.03); border: 1px solid var(--glass-border); padding: 12px; border-radius: 10px; }
        .stat-card h3 { margin: 0 0 5px 0; font-size: 10px; color: var(--text-muted); font-weight: 600; text-transform: uppercase; }
        .stat-card p { margin: 0; font-size: 20px; font-weight: 800; color: var(--text-main); }
        .stat-card.danger p { color: var(--accent-red); }

        /* üìú LIVE FEED */
        .live-list { list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 8px; }
        .live-list li { padding: 12px; background: rgba(0,0,0,0.3); border: 1px solid var(--glass-border); border-radius: 8px; cursor: pointer; transition: 0.2s; position: relative; overflow: hidden; }
        .live-list li:hover { background: rgba(255,255,255,0.05); border-color: rgba(255,255,255,0.2); transform: translateX(5px); }
        .live-list li::before { content: ''; position: absolute; left: 0; top: 0; height: 100%; width: 4px; background: var(--accent-yellow); }
        .live-list li.high-mag::before { background: var(--accent-red); box-shadow: 0 0 10px var(--accent-red); }
        .high-mag .eq-mag { color: var(--accent-red); font-weight: 900; }
        .live-list li.med-mag::before { background: var(--accent-orange); }
        .med-mag .eq-mag { color: var(--accent-orange); font-weight: 800;}
        .eq-mag { font-size: 14px; font-weight: 700; margin-bottom: 4px; display: flex; justify-content: space-between;}
        .eq-loc { color: var(--text-main); font-weight: 500; font-size: 12px; margin-bottom: 4px; line-height: 1.4;}
        .eq-time { color: var(--text-muted); font-size: 10px; display: flex; gap: 5px; align-items: center;}

        /* üßë‚Äçüíª BRANDING FOOTER */
        .branding-footer { padding: 15px 25px; background: rgba(0,0,0,0.5); border-top: 1px solid var(--glass-border); display: flex; align-items: center; justify-content: space-between; }
        .dev-info h4 { margin: 0 0 3px 0; font-size: 13px; color: var(--text-main); font-weight: 700; }
        .dev-info p { margin: 0; font-size: 11px; color: var(--text-muted); display: flex; align-items: center; gap: 4px;}
        .dev-socials { display: flex; gap: 12px; }
        .dev-socials a { color: var(--text-muted); font-size: 16px; transition: 0.2s; cursor: pointer;}
        .dev-socials a:hover { color: var(--accent-red); transform: scale(1.1); }

        /* üßë‚Äçüíª ABOUT MODAL */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); backdrop-filter: blur(5px); z-index: 9999; display: flex; justify-content: center; align-items: center; opacity: 0; visibility: hidden; transition: 0.3s; }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-content { background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 16px; padding: 30px; width: 90%; max-width: 500px; color: var(--text-main); position: relative; transform: translateY(20px); transition: 0.3s; box-shadow: 0 25px 50px rgba(0,0,0,0.8); }
        .modal-overlay.active .modal-content { transform: translateY(0); }
        .close-btn { position: absolute; top: 15px; right: 20px; background: transparent; border: none; color: var(--text-muted); font-size: 20px; cursor: pointer; transition: 0.2s; }
        .close-btn:hover { color: var(--accent-red); transform: scale(1.1); }
        .about-badge { display: inline-block; background: rgba(14, 165, 233, 0.1); color: #0ea5e9; padding: 5px 10px; border-radius: 6px; font-size: 11px; font-weight: 700; margin-bottom: 15px; border: 1px solid rgba(14, 165, 233, 0.3);}

        /* üö® EMERGENCY DIRECTORY VIEW */
        #emergency-view { padding: 30px; background: var(--bg-dark); overflow-y: auto; flex-direction: column; align-items: center; }
        .emergency-header { text-align: center; margin-bottom: 30px; max-width: 800px; width: 100%; }
        .emergency-header h2 { font-size: 32px; font-weight: 800; margin: 0 0 10px 0; color: var(--text-main); }
        .emergency-header p { color: var(--text-muted); font-size: 15px; margin: 0 0 20px 0; }
        
        .em-search { max-width: 500px; width: 100%; margin: 0 auto; }
        .em-search input { background: var(--glass-bg); border: 1px solid var(--glass-border); color: #fff; padding: 15px 20px; border-radius: 12px; width: 100%; font-size: 15px; outline: none; font-family: 'Inter'; text-align: center; box-sizing: border-box;}
        .em-search input:focus { border-color: var(--accent-blue); box-shadow: 0 0 15px rgba(14, 165, 233, 0.2); }

        .emergency-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; max-width: 1200px; width: 100%; margin: 0 auto; padding-bottom: 50px;}
        .country-card { background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 16px; padding: 20px; transition: 0.3s; }
        .country-card:hover { transform: translateY(-5px); border-color: rgba(255,255,255,0.2); box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
        .country-header { display: flex; align-items: center; gap: 10px; border-bottom: 1px solid var(--glass-border); padding-bottom: 12px; margin-bottom: 12px; }
        .country-header h3 { margin: 0; font-size: 18px; font-weight: 700; }
        .country-flag { font-size: 24px; }
        
        .em-numbers { display: flex; flex-direction: column; gap: 8px; }
        .em-row { display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.3); padding: 8px 12px; border-radius: 8px; font-size: 14px; font-weight: 600;}
        .em-row.police i { color: var(--accent-blue); }
        .em-row.ambulance i { color: #10b981; }
        .em-row.fire i { color: var(--accent-orange); }
        .em-num-badge { background: rgba(255,255,255,0.1); padding: 4px 10px; border-radius: 6px; font-weight: 800; letter-spacing: 1px; color: #fff;}

        /* LEAFLET POPUP OVERRIDES */
        .leaflet-popup-content-wrapper { background: rgba(15, 23, 42, 0.9) !important; backdrop-filter: blur(10px); color: #fff !important; border: 1px solid rgba(255,255,255,0.1) !important; border-radius: 12px !important; box-shadow: 0 10px 25px rgba(0,0,0,0.8) !important; font-family: 'Inter', sans-serif;}
        .leaflet-popup-tip { display: none; }

    </style>
</head>
<body>

    <div id="loader">
        <div class="spinner"></div>
        <h2 id="loader-text">Initializing Global Network...</h2>
    </div>

    <div class="modal-overlay" id="aboutModal">
        <div class="modal-content">
            <button class="close-btn" onclick="toggleModal(false)"><i class="fa-solid fa-xmark"></i></button>
            <span class="about-badge">ARCHITECT'S LOG</span>
            <h2 style="margin: 0 0 10px 0; font-weight: 800; font-size: 22px;">Built with Vision & AI üß†üíª</h2>
            <p style="color: var(--text-muted); font-size: 14px; line-height: 1.6;">
                Hi, I'm <b>Umer Asif</b>, a Tech CEO and OSINT Architect based in Rahim Yar Khan, Pakistan. <br><br>
                <b>The Honest Truth:</b> TremorTrack wasn't built by typing every single line of code manually. It was built using a powerful synergy of <b>Human Strategy and AI Execution</b>. I designed the architecture, conceptualized the OSINT features, and directed an AI assistant to rapidly compile the logic and Glassmorphism UI. <br><br>
                The future of development isn't just coding; it's engineering ideas. This radar fetches live USGS satellite data to keep the public informed and safe globally. Welcome to the future of open-source intelligence.
            </p>
            <div style="margin-top: 20px; display: flex; gap: 10px;">
                <a href="#" style="background: #fff; color: #000; padding: 10px 15px; border-radius: 8px; text-decoration: none; font-size: 13px; font-weight: 700;"><i class="fa-brands fa-github"></i> View Source</a>
            </div>
        </div>
    </div>

    <header>
        <div class="brand-container">
            <div class="custom-logo"><i class="fa-solid fa-globe"></i></div>
            <h1>TREMORTRACK <span>| GLOBAL OSINT</span></h1>
        </div>
        
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('radar')"><i class="fa-solid fa-satellite-dish"></i> Live Radar</button>
            <button class="nav-tab" onclick="switchTab('emergency')"><i class="fa-solid fa-truck-medical"></i> SOS Contacts</button>
        </div>

        <div class="system-status">
            <div class="live-dot"></div>
            <span id="header-status-text">USGS SAT-LINK ACTIVE</span>
        </div>
    </header>

    <div id="radar-view" class="view-section active">
        <div id="map"></div>
        
        <div class="sidebar">
            <div class="sidebar-content">
                <h2 class="section-title"><i class="fa-solid fa-chart-line"></i> Global Analytics (24H)</h2>
                
                <div class="stat-grid">
                    <div class="stat-card">
                        <h3>Total Quakes</h3>
                        <p id="total-count">--</p>
                    </div>
                    <div class="stat-card danger">
                        <h3>Mag 5.0+ Alerts</h3>
                        <p id="danger-count">--</p>
                    </div>
                </div>

                <div class="search-box">
                    <i class="fa-solid fa-magnifying-glass"></i>
                    <input type="text" id="radar-search" placeholder="Search City or Country...">
                </div>

                <h2 class="section-title" style="margin-top: 5px;"><i class="fa-solid fa-list-ul"></i> Live Threat Feed</h2>
                <ul class="live-list" id="eq-feed"></ul>
            </div>
            
            <div class="branding-footer">
                <div class="dev-info">
                    <h4>UMER ASIF</h4>
                    <p><i class="fa-solid fa-location-dot" style="color: var(--accent-red);"></i> Rahim Yar Khan, PK</p>
                </div>
                <div class="dev-socials">
                    <a href="javascript:void(0)" onclick="toggleModal(true)" title="About Project" style="color: var(--accent-yellow);"><i class="fa-solid fa-circle-info"></i></a>
                    <a href="#" title="GitHub"><i class="fa-brands fa-github"></i></a>
                    <a href="#" title="X (Twitter)"><i class="fa-brands fa-x-twitter"></i></a>
                </div>
            </div>
        </div>
    </div>

    <div id="emergency-view" class="view-section">
        <div class="emergency-header">
            <h2>Global SOS Directory</h2>
            <p>Critical emergency contact numbers for countries worldwide. Always verify local numbers when traveling.</p>
            <div class="em-search">
                <input type="text" id="em-search-input" placeholder="Enter Country Name (e.g., Pakistan, Japan)..." onkeyup="filterEmergency()">
            </div>
        </div>
        
        <div class="emergency-grid" id="em-grid">
            </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        // üóÇÔ∏è TAB SWITCHING LOGIC
        function switchTab(tabId) {
            document.querySelectorAll('.view-section').forEach(view => view.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(`${tabId}-view`).classList.add('active');
            event.currentTarget.classList.add('active');
            
            if(tabId === 'radar') { 
                setTimeout(() => { map.invalidateSize(); }, 100); 
                document.getElementById('header-status-text').innerText = "USGS SAT-LINK ACTIVE";
                document.querySelector('.custom-logo i').className = "fa-solid fa-globe";
                document.querySelector('.custom-logo i').style.color = "var(--accent-red)";
                document.querySelector('.custom-logo').style.animation = "pulseAlert 2s infinite";
            } else {
                document.getElementById('header-status-text').innerText = "SOS DATABASE ACTIVE";
                document.querySelector('.custom-logo i').className = "fa-solid fa-truck-medical";
                document.querySelector('.custom-logo i').style.color = "#0ea5e9";
                document.querySelector('.custom-logo').style.animation = "none";
                document.querySelector('.custom-logo').style.borderColor = "var(--glass-border)";
            }
        }

        function toggleModal(show) {
            const modal = document.getElementById('aboutModal');
            if(show) modal.classList.add('active');
            else modal.classList.remove('active');
        }

        // üö® EMERGENCY DATABASE (Global List)
        const emergencyData = [
            { country: "Pakistan", flag: "üáµüá∞", police: "15", ambulance: "115", fire: "16" },
            { country: "India", flag: "üáÆüá≥", police: "100", ambulance: "102", fire: "101" },
            { country: "United States", flag: "üá∫üá∏", police: "911", ambulance: "911", fire: "911" },
            { country: "United Kingdom", flag: "üá¨üáß", police: "999", ambulance: "999", fire: "999" },
            { country: "Japan", flag: "üáØüáµ", police: "110", ambulance: "119", fire: "119" },
            { country: "Turkey", flag: "üáπüá∑", police: "112", ambulance: "112", fire: "112" },
            { country: "Canada", flag: "üá®üá¶", police: "911", ambulance: "911", fire: "911" },
            { country: "Australia", flag: "üá¶üá∫", police: "000", ambulance: "000", fire: "000" },
            { country: "Germany", flag: "üá©üá™", police: "110", ambulance: "112", fire: "112" },
            { country: "France", flag: "üá´üá∑", police: "17", ambulance: "15", fire: "18" },
            { country: "Saudi Arabia", flag: "üá∏üá¶", police: "999", ambulance: "997", fire: "998" },
            { country: "United Arab Emirates", flag: "üá¶üá™", police: "999", ambulance: "998", fire: "997" },
            { country: "China", flag: "üá®üá≥", police: "110", ambulance: "120", fire: "119" },
            { country: "Brazil", flag: "üáßüá∑", police: "190", ambulance: "192", fire: "193" },
            { country: "South Africa", flag: "üáøüá¶", police: "10111", ambulance: "10177", fire: "10111" }
        ];

        // Generate Emergency Grid
        function renderEmergencyGrid() {
            const grid = document.getElementById('em-grid');
            grid.innerHTML = '';
            emergencyData.forEach(data => {
                grid.innerHTML += `
                    <div class="country-card">
                        <div class="country-header">
                            <span class="country-flag">${data.flag}</span>
                            <h3>${data.country}</h3>
                        </div>
                        <div class="em-numbers">
                            <div class="em-row police"><span><i class="fa-solid fa-shield-halved"></i> Police</span><span class="em-num-badge">${data.police}</span></div>
                            <div class="em-row ambulance"><span><i class="fa-solid fa-truck-medical"></i> Ambulance</span><span class="em-num-badge">${data.ambulance}</span></div>
                            <div class="em-row fire"><span><i class="fa-solid fa-fire-extinguisher"></i> Fire</span><span class="em-num-badge">${data.fire}</span></div>
                        </div>
                    </div>
                `;
            });
        }
        renderEmergencyGrid();

        // Filter Emergency Grid
        function filterEmergency() {
            let input = document.getElementById('em-search-input').value.toLowerCase();
            let cards = document.querySelectorAll('.country-card');
            cards.forEach(card => {
                let name = card.querySelector('h3').innerText.toLowerCase();
                if(name.includes(input)) card.style.display = "block";
                else card.style.display = "none";
            });
        }

        // üîç RADAR SEARCH LOGIC
        document.getElementById('radar-search').addEventListener('input', function(e) {
            let searchTerm = e.target.value.toLowerCase();
            document.querySelectorAll('#eq-feed li').forEach(li => {
                let loc = li.querySelector('.eq-loc').innerText.toLowerCase();
                li.style.display = loc.includes(searchTerm) ? 'block' : 'none';
            });
        });

        // üó∫Ô∏è LEAFLET SETUP (Dark Theme)
        var map = L.map('map', { zoomControl: false }).setView([20.0, 0.0], 3); 
        L.control.zoom({ position: 'topright' }).addTo(map);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_nolabels/{z}/{x}/{y}{r}.png', { maxZoom: 19 }).addTo(map);
        
        var eqLayer = L.layerGroup().addTo(map);

        function timeAgo(time) {
            let mins = Math.floor((Date.now() - time) / 60000);
            if(mins < 60) return `${mins} mins ago`;
            return `${Math.floor(mins/60)} hrs ago`;
        }

        async function fetchEarthquakes() {
            try {
                let response = await fetch('https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_day.geojson');
                if(!response.ok) throw new Error("USGS Down");
                
                let data = await response.json();
                let quakes = data.features.filter(eq => eq.properties.mag >= 2.0); 
                
                eqLayer.clearLayers(); 
                const feedContainer = document.getElementById('eq-feed');
                feedContainer.innerHTML = ''; 
                
                let dangerCount = 0;

                quakes.forEach(eq => {
                    let mag = parseFloat(eq.properties.mag);
                    let loc = eq.properties.place;
                    let time = eq.properties.time;
                    let coords = eq.geometry.coordinates; 
                    let lat = coords[1], lon = coords[0];

                    let color = '#eab308'; 
                    let listClass = '';
                    
                    if (mag >= 5.0) { color = '#ef4444'; dangerCount++; listClass = 'high-mag'; } 
                    else if (mag >= 4.0) { color = '#f97316'; listClass = 'med-mag'; }

                    L.circleMarker([lat, lon], {
                        radius: Math.max(mag * 4, 6), fillColor: color, color: color, weight: 2, opacity: 0.9, fillOpacity: 0.3
                    }).bindPopup(`
                        <div style="text-align:center;">
                            <h2 style="margin:0 0 5px 0; color:${color}; font-size:24px; font-weight:800;">${mag.toFixed(1)} <span style="font-size:12px; color:#94a3b8; font-weight:400;">MAG</span></h2>
                            <p style="margin:0; font-size:13px; border-top:1px solid rgba(255,255,255,0.1); padding-top:8px;">${loc}</p>
                            <p style="margin:5px 0 0 0; font-size:11px; color:#94a3b8;">${new Date(time).toLocaleString()}</p>
                        </div>
                    `).addTo(eqLayer);

                    if (feedContainer.children.length < 100) {
                        let li = document.createElement('li');
                        li.className = listClass; 
                        
                        // Keep search filter active if typing
                        let currentSearch = document.getElementById('radar-search').value.toLowerCase();
                        if(currentSearch && !loc.toLowerCase().includes(currentSearch)) li.style.display = 'none';

                        li.innerHTML = `
                            <div class="eq-mag"><span>Mag ${mag.toFixed(1)}</span> <i class="fa-solid fa-satellite-dish" style="font-size:12px; opacity:0.5;"></i></div>
                            <div class="eq-loc">${loc}</div>
                            <div class="eq-time"><i class="fa-regular fa-clock"></i> ${timeAgo(time)}</div>
                        `;
                        li.onclick = () => { map.flyTo([lat, lon], 7, {duration: 1.5}); };
                        feedContainer.appendChild(li);
                    }
                });

                document.getElementById('total-count').innerText = quakes.length;
                document.getElementById('danger-count').innerText = dangerCount;
                setTimeout(() => { document.getElementById('loader').style.animation = 'fadeOut 0.5s forwards'; }, 800);

            } catch (error) {
                console.error(error);
                document.getElementById('loader-text').innerText = "CONNECTION FAILED. RETRYING...";
                document.getElementById('loader-text').style.color = "#ef4444";
            }
        }

        fetchEarthquakes();
        setInterval(fetchEarthquakes, 300000); 

    </script>
</body>
</html>
